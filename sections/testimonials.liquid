{%- comment -%}
Testimonials Section - Pitagora Theme
Carousel de testimonios con ratings y autor info
{%- endcomment -%}

{{ 'testimonials.css' | asset_url | stylesheet_tag }}
<script src="{{ 'testimonials.js' | asset_url }}" defer="defer"></script>

<style>
  #shopify-section-{{ section.id }} {
    --testimonials-bg: {{ section.settings.background_color | default: 'transparent' }};
    --testimonials-text: {{ section.settings.text_color | default: 'inherit' }};
  }
</style>

{%- if section.blocks.size > 0 -%}
  <div 
    class="testimonials section-padding"
    style="background: var(--testimonials-bg); color: var(--testimonials-text);"
  >
    <div class="page-width">
      {%- if section.settings.heading != blank or section.settings.subheading != blank -%}
        <div class="section-header text-center">
          {%- if section.settings.subheading != blank -%}
            <p class="section-header__subheading">{{ section.settings.subheading | escape }}</p>
          {%- endif -%}
          
          {%- if section.settings.heading != blank -%}
            <h2 class="section-header__heading h2">{{ section.settings.heading | escape }}</h2>
          {%- endif -%}
        </div>
      {%- endif -%}

      <testimonials-carousel
        class="testimonials__wrapper"
        data-section-id="{{ section.id }}"
        data-layout="{{ section.settings.layout }}"
        data-autoplay="{% if section.settings.autoplay %}true{% else %}false{% endif %}"
        data-autoplay-duration="{{ section.settings.autoplay_duration | default: 5 }}"
        data-testimonials-count="{{ section.settings.testimonials_to_show | default: 3 }}"
      >
        {%- assign testimonials_to_show = section.settings.testimonials_to_show | default: 3 -%}
        
        {%- if section.settings.layout == 'carousel' -%}
          <div class="testimonials__carousel">
            <div class="testimonials__slides">
              {%- for block in section.blocks limit: testimonials_to_show -%}
                {% render 'testimonial-card',
                  block: block,
                  show_ratings: section.settings.show_ratings,
                  show_author_image: section.settings.show_author_image,
                  index: forloop.index0,
                  is_first: forloop.first
                %}
              {%- endfor -%}
            </div>

            {%- if section.blocks.size > 1 -%}
              <div class="testimonials__navigation">
                <button 
                  class="testimonials__nav-button testimonials__nav-button--prev"
                  type="button"
                  aria-label="{{ 'accessibility.previous' | t }}"
                >
                  {% render 'icon-chevron-left' %}
                </button>
                <button 
                  class="testimonials__nav-button testimonials__nav-button--next"
                  type="button"
                  aria-label="{{ 'accessibility.next' | t }}"
                >
                  {% render 'icon-chevron-right' %}
                </button>
              </div>

              <div class="testimonials__pagination">
                {%- for block in section.blocks limit: testimonials_to_show -%}
                  <button 
                    class="testimonials__pagination-bullet{% if forloop.first %} testimonials__pagination-bullet--active{% endif %}"
                    type="button"
                    data-slide-index="{{ forloop.index0 }}"
                    aria-label="{{ 'accessibility.slide' | t }} {{ forloop.index }}"
                  ></button>
                {%- endfor -%}
              </div>
            {%- endif -%}
          </div>
        {%- else -%}
          <div class="testimonials__grid">
            {%- for block in section.blocks limit: testimonials_to_show -%}
              {% render 'testimonial-card',
                block: block,
                show_ratings: section.settings.show_ratings,
                show_author_image: section.settings.show_author_image,
                index: forloop.index0,
                is_first: forloop.first
              %}
            {%- endfor -%}
          </div>
        {%- endif -%}
      </testimonials-carousel>
    </div>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Testimonials",
  "class": "shopify-section-testimonials",
  "tag": "section",
  "max_blocks": 12,
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "What our customers say"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Real experiences from satisfied customers"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "options": [
        {
          "value": "carousel",
          "label": "Carousel"
        },
        {
          "value": "grid",
          "label": "Grid"
        }
      ],
      "default": "carousel"
    },
    {
      "type": "range",
      "id": "testimonials_to_show",
      "label": "Testimonials to show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 6
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Enable autoplay",
      "default": true,
      "info": "Only applies to carousel layout"
    },
    {
      "type": "range",
      "id": "autoplay_duration",
      "label": "Autoplay duration",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "default": 5,
      "info": "Only applies when autoplay is enabled"
    },
    {
      "type": "header",
      "content": "Testimonial cards"
    },
    {
      "type": "checkbox",
      "id": "show_ratings",
      "label": "Show star ratings",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_author_image",
      "label": "Show author images",
      "default": true
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "textarea",
          "id": "quote",
          "label": "Quote",
          "default": "Excellent quality and customer service. I would definitely buy here again."
        },
        {
          "type": "text",
          "id": "author",
          "label": "Author name",
          "default": "Customer Name"
        },
        {
          "type": "text",
          "id": "author_title",
          "label": "Author title",
          "default": "Verified customer",
          "info": "e.g. 'Verified buyer', 'Long-time customer'"
        },
        {
          "type": "image_picker",
          "id": "author_image",
          "label": "Author image"
        },
        {
          "type": "range",
          "id": "rating",
          "label": "Star rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        },
        {
          "type": "product",
          "id": "product",
          "label": "Featured product",
          "info": "Optional. Links the testimonial to a specific product."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "quote": "Excellent quality and customer service. I would definitely buy here again.",
            "author": "María González",
            "author_title": "Verified customer",
            "rating": 5
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "quote": "The products exceeded my expectations. Fast shipping and impeccable packaging.",
            "author": "Carlos Martínez",
            "author_title": "Frequent buyer",
            "rating": 5
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "quote": "An exceptional shopping experience. The attention to detail is remarkable.",
            "author": "Ana López",
            "author_title": "First purchase",
            "rating": 5
          }
        }
      ]
    }
  ]
}
{% endschema %}