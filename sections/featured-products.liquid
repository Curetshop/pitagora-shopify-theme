{%- comment -%}
Featured Products Section - Pitagora Theme
Grid de productos destacados con filtros b√°sicos y sorting
{%- endcomment -%}

{{ 'featured-products.css' | asset_url | stylesheet_tag }}

<style>
  #shopify-section-{{ section.id }} {
    --featured-products-bg: {{ section.settings.background_color | default: 'transparent' }};
    --featured-products-text: {{ section.settings.text_color | default: 'inherit' }};
    --columns-desktop: {{ section.settings.columns_desktop | default: 4 }};
    --columns-tablet: {{ section.settings.columns_tablet | default: 3 }};
    --columns-mobile: {{ section.settings.columns_mobile | default: 2 }};
  }
</style>

<div 
  class="featured-products section-padding"
  style="background: var(--featured-products-bg); color: var(--featured-products-text);"
>
  <div class="page-width">
    {%- if section.settings.heading != blank or section.settings.subheading != blank -%}
      <div class="section-header text-center">
        {%- if section.settings.subheading != blank -%}
          <p class="section-header__subheading">{{ section.settings.subheading | escape }}</p>
        {%- endif -%}
        
        {%- if section.settings.heading != blank -%}
          <h2 class="section-header__heading h2">{{ section.settings.heading | escape }}</h2>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- liquid
      assign collection = collections[section.settings.collection]
      if collection == empty
        assign products = collections.all.products
      else
        assign products = collection.products
      endif
      
      assign products_to_show = section.settings.products_to_show | default: 8
    -%}

    {%- if section.settings.enable_filtering or section.settings.enable_sorting -%}
      <div class="featured-products__toolbar">
        {%- if section.settings.enable_filtering -%}
          <div class="featured-products__filters">
            <button class="featured-products__filter-toggle button button--secondary button--small">
              {% render 'icon-filter' %}
              {{ 'collections.general.filter_and_sort' | t }}
            </button>
          </div>
        {%- endif -%}

        {%- if section.settings.enable_sorting -%}
          <div class="featured-products__sort">
            <label for="featured-sort-{{ section.id }}" class="visually-hidden">
              {{ 'collections.sorting.title' | t }}
            </label>
            <select 
              id="featured-sort-{{ section.id }}" 
              class="featured-products__sort-select"
              data-section-sort
            >
              <option value="manual">{{ 'collections.sorting.featured' | t }}</option>
              <option value="best-selling">{{ 'collections.sorting.best_selling' | t }}</option>
              <option value="title-ascending">{{ 'collections.sorting.alphabetically_a_z' | t }}</option>
              <option value="title-descending">{{ 'collections.sorting.alphabetically_z_a' | t }}</option>
              <option value="price-ascending">{{ 'collections.sorting.price_low_to_high' | t }}</option>
              <option value="price-descending">{{ 'collections.sorting.price_high_to_low' | t }}</option>
              <option value="created-descending">{{ 'collections.sorting.date_new_to_old' | t }}</option>
              <option value="created-ascending">{{ 'collections.sorting.date_old_to_new' | t }}</option>
            </select>
          </div>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="featured-products__wrapper">
      {%- if products.size > 0 -%}
        <div class="featured-products__grid" id="featured-products-grid-{{ section.id }}">
          {%- for product in products limit: products_to_show -%}
            {%- render 'product-card',
              product: product,
              show_quick_add: section.settings.show_quick_add,
              show_quick_view: section.settings.show_quick_view,
              show_vendor: section.settings.show_vendor,
              show_rating: section.settings.show_rating,
              show_price: section.settings.show_price,
              image_ratio: section.settings.image_ratio,
              card_style: 'standard',
              loading: forloop.index
            -%}
          {%- endfor -%}
        </div>
      {%- else -%}
        <div class="featured-products__empty">
          <div class="featured-products__empty-content">
            <h3>{{ 'collections.general.no_matches' | t }}</h3>
            <p>{{ 'collections.general.no_products_html' | t }}</p>
            <a href="{{ routes.all_products_collection_url }}" class="button button--primary">
              {{ 'general.continue_shopping' | t }}
            </a>
          </div>
        </div>
      {%- endif -%}

      {%- if section.settings.show_view_all and products.size > products_to_show -%}
        <div class="featured-products__view-all">
          {%- liquid
            assign view_all_url = section.settings.view_all_url
            if view_all_url == blank and collection != empty
              assign view_all_url = collection.url
            elsif view_all_url == blank
              assign view_all_url = routes.all_products_collection_url
            endif
          -%}
          
          <a 
            href="{{ view_all_url }}" 
            class="button button--outline button--large"
          >
            {{ section.settings.view_all_text | default: 'View all products' | escape }}
          </a>
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Featured products",
  "class": "shopify-section-featured-products",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured products"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Our customer favorites"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Leave empty to show products from all collections"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Products to show",
      "min": 2,
      "max": 24,
      "step": 2,
      "default": 8
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "label": "Desktop columns",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 4
    },
    {
      "type": "range",
      "id": "columns_tablet",
      "label": "Tablet columns",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 3
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "Mobile columns",
      "options": [
        {
          "value": "1",
          "label": "1 column"
        },
        {
          "value": "2",
          "label": "2 columns"
        }
      ],
      "default": "2"
    },
    {
      "type": "header",
      "content": "Product cards"
    },
    {
      "type": "checkbox",
      "id": "show_quick_add",
      "label": "Enable quick add",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_quick_view",
      "label": "Enable quick view",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show product rating",
      "default": true,
      "info": "To display a rating, add a product rating app. Learn more"
    },
    {
      "type": "checkbox",
      "id": "show_price",
      "label": "Show price",
      "default": true
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Image ratio",
      "options": [
        {
          "value": "square",
          "label": "Square"
        },
        {
          "value": "portrait",
          "label": "Portrait"
        },
        {
          "value": "landscape",
          "label": "Landscape"
        },
        {
          "value": "auto",
          "label": "Natural"
        }
      ],
      "default": "square"
    },
    {
      "type": "header",
      "content": "Filtering and sorting"
    },
    {
      "type": "checkbox",
      "id": "enable_filtering",
      "label": "Enable filtering",
      "default": false,
      "info": "Basic filtering by availability, price, and type"
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "label": "Enable sorting",
      "default": false
    },
    {
      "type": "header",
      "content": "View all"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View all' button",
      "default": true
    },
    {
      "type": "text",
      "id": "view_all_text",
      "label": "Button text",
      "default": "View all products"
    },
    {
      "type": "url",
      "id": "view_all_url",
      "label": "Button URL",
      "info": "Leave empty to use collection URL"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color"
    }
  ],
  "presets": [
    {
      "name": "Featured products",
      "settings": {
        "heading": "Featured products",
        "subheading": "Our customer favorites",
        "products_to_show": 8,
        "show_quick_add": true,
        "show_rating": true,
        "show_view_all": true
      }
    }
  ]
}
{% endschema %}