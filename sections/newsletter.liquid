{%- comment -%}
Newsletter Section - Pitagora Theme
Newsletter signup con validaci√≥n y success states
{%- endcomment -%}

{{ 'newsletter.css' | asset_url | stylesheet_tag }}
<script src="{{ 'newsletter.js' | asset_url }}" defer="defer"></script>

<style>
  #shopify-section-{{ section.id }} {
    {%- if section.settings.background_type == 'color' -%}
      --newsletter-bg: {{ section.settings.background_color | default: '#f8fafc' }};
    {%- elsif section.settings.background_type == 'image' and section.settings.background_image != blank -%}
      --newsletter-bg-image: url('{{ section.settings.background_image | image_url: width: 1920 }}');
    {%- endif -%}
    --newsletter-text: {{ section.settings.text_color | default: '#1f2937' }};
    --newsletter-button-bg: {{ section.settings.button_background | default: '#3b82f6' }};
    --newsletter-button-text: {{ section.settings.button_text_color | default: '#ffffff' }};
  }
</style>

<div class="newsletter section-padding{% if section.settings.background_type == 'image' %} newsletter--has-bg-image{% endif %}">
  {%- if section.settings.background_type == 'image' and section.settings.background_image != blank -%}
    <div class="newsletter__bg-image">
      <img
        src="{{ section.settings.background_image | image_url: width: 1920 }}"
        alt="{{ section.settings.background_image.alt | escape }}"
        loading="lazy"
        width="{{ section.settings.background_image.width }}"
        height="{{ section.settings.background_image.height }}"
        sizes="100vw"
        srcset="
          {{ section.settings.background_image | image_url: width: 600 }} 600w,
          {{ section.settings.background_image | image_url: width: 900 }} 900w,
          {{ section.settings.background_image | image_url: width: 1200 }} 1200w,
          {{ section.settings.background_image | image_url: width: 1500 }} 1500w,
          {{ section.settings.background_image | image_url: width: 1920 }} 1920w
        "
      >
    </div>
    <div class="newsletter__overlay" style="background: rgba(0, 0, 0, {{ section.settings.overlay_opacity | divided_by: 100.0 }});"></div>
  {%- endif -%}

  <div class="page-width">
    <newsletter-signup 
      class="newsletter__container"
      data-section-id="{{ section.id }}"
    >
      <div class="newsletter__content">
        {%- if section.settings.heading != blank -%}
          <h2 class="newsletter__heading h2">{{ section.settings.heading | escape }}</h2>
        {%- endif -%}

        {%- if section.settings.subheading != blank -%}
          <p class="newsletter__subheading">{{ section.settings.subheading | escape }}</p>
        {%- endif -%}

        {%- if section.settings.text != blank -%}
          <div class="newsletter__text rte">
            {{ section.settings.text }}
          </div>
        {%- endif -%}
      </div>

      <div class="newsletter__form-wrapper">
        {%- form 'customer', class: 'newsletter__form' -%}
          <input type="hidden" name="contact[tags]" value="newsletter">
          
          <div class="newsletter__form-fields">
            {%- if section.settings.show_name_field -%}
              <div class="newsletter__field">
                <label for="newsletter-name-{{ section.id }}" class="visually-hidden">
                  {{ 'general.newsletter.name' | t }}
                </label>
                <input
                  type="text"
                  id="newsletter-name-{{ section.id }}"
                  name="contact[first_name]"
                  class="newsletter__input"
                  placeholder="{{ 'general.newsletter.name_placeholder' | t }}"
                  autocomplete="given-name"
                  {%- if section.settings.show_name_field -%}required{%- endif -%}
                >
              </div>
            {%- endif -%}

            <div class="newsletter__field newsletter__field--email">
              <label for="newsletter-email-{{ section.id }}" class="visually-hidden">
                {{ 'general.newsletter.email' | t }}
              </label>
              <input
                type="email"
                id="newsletter-email-{{ section.id }}"
                name="contact[email]"
                class="newsletter__input"
                placeholder="{{ 'general.newsletter.email_placeholder' | t }}"
                autocomplete="email"
                required
                aria-describedby="newsletter-error-{{ section.id }}"
              >
            </div>

            <button 
              type="submit" 
              class="newsletter__submit button"
              name="commit"
            >
              <span class="newsletter__submit-text">
                {{ section.settings.button_text | default: 'Subscribe' | escape }}
              </span>
              <span class="newsletter__submit-loading" hidden>
                <svg class="newsletter__loading-spinner" viewBox="0 0 20 20">
                  <path fill="currentColor" d="M10,1V3a7,7,0,1,1-7,7H1a9,9,0,1,0,9-9Z"/>
                </svg>
                {{ 'general.newsletter.submitting' | t }}
              </span>
            </button>
          </div>
        {%- endform -%}

        <div class="newsletter__messages">
          <div 
            class="newsletter__success" 
            id="newsletter-success-{{ section.id }}" 
            role="status"
            aria-live="polite"
            hidden
          >
            {%- render 'icon-checkmark' -%}
            <span>{{ section.settings.success_message | default: 'Thanks for subscribing!' | escape }}</span>
          </div>

          <div 
            class="newsletter__error" 
            id="newsletter-error-{{ section.id }}" 
            role="alert"
            aria-live="assertive"
            hidden
          >
            <span class="newsletter__error-text"></span>
          </div>
        </div>
      </div>
    </newsletter-signup>
  </div>
</div>

{% schema %}
{
  "name": "Newsletter",
  "class": "shopify-section-newsletter",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Stay in the loop"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Subscribe for exclusive offers and updates"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Text",
      "default": "<p>Be the first to know about our new products, special offers and exclusive content.</p>"
    },
    {
      "type": "header",
      "content": "Form"
    },
    {
      "type": "checkbox",
      "id": "show_name_field",
      "label": "Show name field",
      "default": false
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Subscribe"
    },
    {
      "type": "text",
      "id": "success_message",
      "label": "Success message",
      "default": "Thanks for subscribing! We'll keep you posted."
    },
    {
      "type": "header",
      "content": "Background"
    },
    {
      "type": "select",
      "id": "background_type",
      "label": "Background type",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "color",
          "label": "Color"
        },
        {
          "value": "image",
          "label": "Image"
        }
      ],
      "default": "color"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#f8fafc"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background image"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Image overlay opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 30,
      "info": "Only applies when using background image"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#1f2937"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Button background",
      "default": "#3b82f6"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#ffffff"
    }
  ],
  "presets": [
    {
      "name": "Newsletter",
      "settings": {
        "heading": "Stay in the loop",
        "subheading": "Subscribe for exclusive offers and updates",
        "background_type": "color",
        "background_color": "#f8fafc"
      }
    }
  ]
}
{% endschema %}