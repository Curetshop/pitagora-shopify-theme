{%- comment -%}
Product Inventory Notice - Pitagora Theme
Shows inventory status and availability messages

Parameters:
- variant: product variant object (required)
- class: additional CSS classes (optional)
{%- endcomment -%}

{%- liquid
  unless variant
    assign variant = product.selected_or_first_available_variant
  endunless
  
  if variant == blank
    assign variant = product.variants.first
  endif
-%}

{%- if variant -%}
  <div class="product-inventory-notice {{ class }}" data-variant-inventory>
    {%- liquid
      assign inventory_quantity = variant.inventory_quantity
      assign inventory_policy = variant.inventory_policy
      assign inventory_management = variant.inventory_management
      assign available = variant.available
      
      # Determine inventory status
      assign show_inventory = false
      assign inventory_status = ''
      assign inventory_message = ''
      assign low_stock_threshold = 10
      
      if inventory_management == 'shopify' and inventory_policy == 'deny'
        assign show_inventory = true
        
        if available == false
          assign inventory_status = 'out-of-stock'
          assign inventory_message = 'products.product.out_of_stock' | t
        elsif inventory_quantity <= 0
          assign inventory_status = 'out-of-stock'
          assign inventory_message = 'products.product.out_of_stock' | t
        elsif inventory_quantity <= low_stock_threshold
          assign inventory_status = 'low-stock'
          assign inventory_message = 'products.product.low_stock' | t: count: inventory_quantity
        else
          assign inventory_status = 'in-stock'
          assign inventory_message = 'products.product.in_stock' | t
        endif
      elsif available == false
        assign show_inventory = true
        assign inventory_status = 'out-of-stock'
        assign inventory_message = 'products.product.out_of_stock' | t
      elsif inventory_management != 'shopify'
        assign show_inventory = true
        assign inventory_status = 'in-stock'
        assign inventory_message = 'products.product.in_stock' | t
      endif
    -%}

    {%- if show_inventory -%}
      <div class="inventory-notice inventory-notice--{{ inventory_status }}" data-inventory-status="{{ inventory_status }}">
        <div class="inventory-notice__content">
          {%- case inventory_status -%}
            {%- when 'in-stock' -%}
              <div class="inventory-notice__icon inventory-notice__icon--success">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
              </div>
              <span class="inventory-notice__message inventory-notice__message--success">
                {{ inventory_message }}
              </span>
            {%- when 'low-stock' -%}
              <div class="inventory-notice__icon inventory-notice__icon--warning">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                </svg>
              </div>
              <span class="inventory-notice__message inventory-notice__message--warning">
                {{ inventory_message }}
              </span>
            {%- when 'out-of-stock' -%}
              <div class="inventory-notice__icon inventory-notice__icon--error">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
              </div>
              <span class="inventory-notice__message inventory-notice__message--error">
                {{ inventory_message }}
              </span>
          {%- endcase -%}
        </div>

        {%- comment -%} Additional inventory information {%- endcomment -%}
        {%- if inventory_status == 'low-stock' or inventory_status == 'in-stock' -%}
          {%- if variant.next_incoming_date -%}
            <div class="inventory-notice__incoming">
              <small class="inventory-notice__incoming-text">
                {{ 'products.product.next_incoming_date' | t: date: variant.next_incoming_date | date: "%B %d, %Y" }}
              </small>
            </div>
          {%- endif -%}
        {%- endif -%}

        {%- comment -%} Back in stock notification for sold out products {%- endcomment -%}
        {%- if inventory_status == 'out-of-stock' and variant.available == false -%}
          <div class="inventory-notice__back-in-stock">
            <button type="button" class="inventory-notice__notify-button link" data-back-in-stock-trigger data-variant-id="{{ variant.id }}">
              {{ 'products.product.notify_when_available' | t }}
            </button>
          </div>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>
{%- endif -%}

<style>
  .product-inventory-notice {
    margin-top: 1rem;
  }

  .inventory-notice {
    border-radius: 0.375rem;
    padding: 0.75rem 1rem;
    font-size: 0.875rem;
    border: 1px solid;
  }

  .inventory-notice--in-stock {
    background-color: var(--color-success-background, #f0f9ff);
    border-color: var(--color-success, #10b981);
    color: var(--color-success, #10b981);
  }

  .inventory-notice--low-stock {
    background-color: var(--color-warning-background, #fffbeb);
    border-color: var(--color-warning, #f59e0b);
    color: var(--color-warning, #f59e0b);
  }

  .inventory-notice--out-of-stock {
    background-color: var(--color-error-background, #fef2f2);
    border-color: var(--color-error, #ef4444);
    color: var(--color-error, #ef4444);
  }

  .inventory-notice__content {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .inventory-notice__icon {
    width: 1rem;
    height: 1rem;
    flex-shrink: 0;
  }

  .inventory-notice__icon svg {
    width: 100%;
    height: 100%;
  }

  .inventory-notice__message {
    font-weight: 500;
    flex: 1;
  }

  .inventory-notice__incoming {
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px solid currentColor;
    opacity: 0.7;
  }

  .inventory-notice__incoming-text {
    font-size: 0.75rem;
  }

  .inventory-notice__back-in-stock {
    margin-top: 0.75rem;
  }

  .inventory-notice__notify-button {
    background: none;
    border: none;
    padding: 0;
    font-size: 0.875rem;
    text-decoration: underline;
    cursor: pointer;
    color: currentColor;
  }

  .inventory-notice__notify-button:hover {
    text-decoration: none;
  }

  /* Hide notice when variant changes */
  .inventory-notice[data-inventory-status="hidden"] {
    display: none;
  }
</style>